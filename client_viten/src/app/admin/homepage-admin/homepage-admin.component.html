<div class="flexParent">
  <div class="leftSide surveyList">
    <app-all-surveys></app-all-surveys>
  </div>
  <div class="rightSide" #surveyDOM>


    <md-menu #downloadMenu="mdMenu"  x-position="before" y-position="below" [overlapTrigger]="false">
      <button md-menu-item  (click)="downloadAsPDF()" [disabled]="generatingPDF">
        <md-icon>picture_as_pdf</md-icon> {{ 'Download as PDF' | translate }}
      </button>
      <button md-menu-item (click)="downloadAs('json')" >
        <md-icon>file_download</md-icon> {{ 'Download as JSON' | translate }}
      </button>
      <button md-menu-item (click)="downloadAs('csv')" >
        <md-icon>timeline</md-icon> {{ 'Download Raw Data' | translate }}
      </button>
    </md-menu>





    <md-menu #copyMenu="mdMenu"  x-position="before" y-position="below" [overlapTrigger]="false">
      <button md-menu-item  (click)="copySurvey(false)" [disabled]="generatingPDF">
        {{ 'Copy' | translate }}
      </button>
      <button md-menu-item (click)="copySurvey(true)" [disabled] = "(responses ? responses.length : 0) == 0">
        {{ 'Copy with responses' | translate }}
      </button>
    </md-menu>





    <div *ngIf="survey && responses && !loadingSurvey && !loadingPostSurvey" class="selectedSurveyArea" [@fadeIn]="">
      <md-toolbar style = "background: none !important;">
        <div class="flexchild"></div>
        <div class="flexchild alignCenter"></div>
        <div class="flexchild alignRight">
          <button md-raised-button color="primary" [mdMenuTriggerFor]="goToMenu" [disabled]="!survey.active">
          <span [mdTooltip]="(!survey.active) ?
          ('The survey is not active' | translate ) : '' "
          mdTooltipPosition="below">
          <md-icon class="openInBrowser">open_in_browser</md-icon>
          {{ 'Go to survey' | translate }}
        </span>
          </button>
          <md-menu #goToMenu="mdMenu"  x-position="before" y-position="below" [overlapTrigger]="false">
            <button md-menu-item  routerLink="/survey/{{survey._id}}" routerLinkActive="active">
              {{ 'Go to survey' | translate }}
            </button>
            <button *ngIf="survey.postKey && survey.postKey.length > 0" md-menu-item routerLink="/survey/{{survey.postKey}}" routerLinkActive="active">
              {{ 'Go to post survey' | translate }}
            </button>
          </md-menu>
          <button md-raised-button color="primary" [mdMenuTriggerFor]="downloadMenu" [disabled] = "(responses ? responses.length : 0) == 0">
            <md-icon>file_download</md-icon>{{'Download' | translate}}</button>
          <!-- display ADD post survey if there is no post survey, else display edit post survey  -->
          <button *ngIf="!survey.postKey || !(survey.postKey.length > 0)" md-raised-button color="accent" routerLink="/admin/editsurvey/{{survey._id}}/prepost" routerLinkActive="active">
            <md-icon>local_post_office</md-icon> {{ 'Create post-survey' | translate }}
          </button>
          <button *ngIf="survey.postKey && survey.postKey.length > 0" md-raised-button color="accent" routerLink="/admin/editsurvey/{{survey.postKey}}" routerLinkActive="active">
            <md-icon>local_post_office</md-icon> {{ 'Edit post-survey' | translate }}
          </button>
          <button md-raised-button color="accent" routerLink="/admin/editsurvey/{{survey._id}}" routerLinkActive="active">
            <md-icon>build</md-icon> {{ 'Edit' | translate }}
          </button>
          <button md-raised-button color="primary" [mdMenuTriggerFor]="copyMenu"><md-icon>content_copy</md-icon>{{'Copy' | translate}}</button>
          <button md-raised-button color="warn" (click)="deleteSurvey(survey._id)" [disabled] = "this.authenticationService.getUser().role !== 'admin'">
              <md-icon>delete</md-icon> {{ 'Delete' | translate }}
          </button>
        </div>
      </md-toolbar>
      <md-card>
        <md-card-title-group>
          <md-card-title>{{survey.name}}</md-card-title>
          <md-card-subtitle>{{survey.comment}}</md-card-subtitle>
          <md-card-subtitle>{{
            (postSurvey && postResponses)
            ? ('Number of responses: n, m' | translate: [responses ? responses.length : 0, postResponses ? postResponses.length : 0])
            : ('Number of responses: n' | translate: [responses ? responses.length : 0])
          }}</md-card-subtitle>
          <md-icon align="left" class="activeIcon"
          [ngClass]="{active: survey.active, surveyActiveIcon: true}"
          [mdTooltip]="(survey.active ? 'Active' : 'Inactive') | translate" tooltip-position="above">{{ survey.active === true ? "visibility" : "visibility_off"}}</md-icon>
        </md-card-title-group>
        <md-card-content>
          <div *ngIf="survey.postKey && survey.postKey.length > 1" class="chip">
            <md-chip-list>
              <md-chip color="accent" selected="true" disabled="true">PRE - POST</md-chip>
            </md-chip-list>
          </div>
          <div class="activeToggle">
            <md-slide-toggle color="primary" [checked]="survey.active" (change)="toggleActive()">
            </md-slide-toggle>
          </div>
          <app-survey-retrieval *ngIf="responses && responses.length > 0"
          [survey] = "survey" [responses] = "responses" [postSurvey] = "postSurvey" [postResponses] = "postResponses" class="surveyRetrieval"></app-survey-retrieval>
          <div *ngIf="responses.length == 0">
            {{   'No responses have been registered, so there is nothing to show here yet.' | translate }}
          </div>
          <!-- file_download // Icon for download -->
        </md-card-content>
        <md-card-actions align="right">
          <button md-raised-button color="primary" [mdMenuTriggerFor]="goToMenu" [disabled]="!survey.active">
          <span [mdTooltip]="(!survey.active) ?
          ('The survey is not active' | translate ) : '' "
          mdTooltipPosition="below">
          <md-icon class="openInBrowser">open_in_browser</md-icon>
          {{ 'Go to survey' | translate }}
        </span>
          </button>
          <md-menu #goToMenu="mdMenu"  x-position="before" y-position="below" [overlapTrigger]="false">
            <button md-menu-item  routerLink="/survey/{{survey._id}}" routerLinkActive="active">
              {{ 'Go to survey' | translate }}
            </button>
            <button *ngIf="survey.postKey && survey.postKey.length > 0" md-menu-item routerLink="/survey/{{survey.postKey}}" routerLinkActive="active">
              {{ 'Go to post survey' | translate }}
            </button>
          </md-menu>
          <button md-raised-button color="primary" [mdMenuTriggerFor]="downloadMenu" [disabled] = "(responses ? responses.length : 0) == 0"
            ><md-icon>file_download</md-icon>{{'Download' | translate}}</button>
          <!-- display ADD post survey if there is no post survey, else display edit post survey  -->
          <button *ngIf="!survey.postKey || !(survey.postKey.length > 0)" md-raised-button color="accent" routerLink="/admin/editsurvey/{{survey._id}}/prepost" routerLinkActive="active">
            <md-icon>local_post_office</md-icon> {{ 'Create post-survey' | translate }}
          </button>
          <button *ngIf="survey.postKey && survey.postKey.length > 0" md-raised-button color="accent" routerLink="/admin/editsurvey/{{survey.postKey}}" routerLinkActive="active">
            <md-icon>local_post_office</md-icon> {{ 'Edit post-survey' | translate }}
          </button>
          <button md-raised-button color="accent" routerLink="/admin/editsurvey/{{survey._id}}" routerLinkActive="active">
            <md-icon>build</md-icon> {{ 'Edit' | translate }}
          </button>
          <button md-raised-button color="accent" [mdMenuTriggerFor]="copyMenu"><md-icon>content_copy</md-icon>{{'Copy' | translate}}</button>
          <button md-raised-button color="warn" (click)="deleteSurvey(survey._id)" [disabled] = "this.authenticationService.getUser().role !== 'admin'">
            <md-icon>delete</md-icon> {{ 'Delete' | translate }}
          </button>
        </md-card-actions>
      </md-card>
    </div>
    <div *ngIf="!survey || loadingSurvey" class="emptyArea">
      <md-progress-spinner *ngIf="loadingSurvey" mode="indeterminate" class="loadingCircle" color="primary"></md-progress-spinner>
      <div *ngIf="!loadingSurvey" class="center">
        {{'Select a survey from the left side menu' | translate }}
      </div>
  </div>
</div>
